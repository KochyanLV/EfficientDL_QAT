# –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ sasrec

## ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –§–ê–ô–õ–´ (–ù–ï –£–î–ê–õ–Ø–¢–¨)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ `/sasrec/`

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|------|--------|----------------|
| `config.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| `training.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π |
| `README.md` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |
| `data/movie-lens_1m.txt` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –î–∞—Ç–∞—Å–µ—Ç MovieLens-1M |

### `/sasrec/src/`

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|------|--------|----------------|
| `dataset.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py`, `main.py`, `main_simple.py` |
| `trainer.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py`, `main.py`, `main_simple.py` |

### `/sasrec/src/model/`

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------|--------|----------------|------------|
| `__init__.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π | |
| `sasrec.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å | |
| `sasrec_lsq.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | LSQ –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `sasrec_pact.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | PACT –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `sasrec_adaround.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | AdaRound –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `sasrec_apot.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | APoT –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `sasrec_dorefa.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | DoReFa –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `sasrec_ste.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `training.py` | STE –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è |
| `embedding_layer.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `sasrec.py` | –°–ª–æ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ |
| `self_attn_block.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `sasrec.py` | –ë–ª–æ–∫ self-attention |
| `pointwise_ffnn.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `self_attn_block.py` | Feed-forward —Å–µ—Ç—å |

### `/sasrec/src/utils/`

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|------|--------|----------------|
| `__init__.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | –≠–∫—Å–ø–æ—Ä—Ç —É—Ç–∏–ª–∏—Ç |
| `utils.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `dataset.py`, `trainer.py` |
| `get_scheduler.py` | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | `trainer.py` |

---

## ‚ùå –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –§–ê–ô–õ–´ (–ú–û–ñ–ù–û –£–î–ê–õ–ò–¢–¨)

### `/sasrec/src/`

| –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ | –ó–∞–º–µ–Ω—ë–Ω –Ω–∞ |
|------|---------|------------|
| ‚ùå `main.py` | –°—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç —Å mlflow | `training.py` |
| ‚ùå `main_simple.py` | –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | `training.py` |

### `/sasrec/src/model/`

| –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
|------|---------|--------------|
| ‚ùå `self_attn.py` | **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –ù–ò–ì–î–ï** | `nn.MultiheadAttention` –≤ `self_attn_block.py` |
| ‚ùå `scaled_dotprod_attn.py` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `self_attn.py` | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ PyTorch |

### `/sasrec/src/utils/`

| –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ | –ó–∞–º–µ–Ω—ë–Ω –Ω–∞ |
|------|---------|------------|
| ‚ùå `arguments.py` | –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ | `config.py` |

---

## üìä –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):

```
training.py
‚îú‚îÄ‚îÄ config.py ‚úÖ
‚îú‚îÄ‚îÄ src/dataset.py ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ src/utils/utils.py ‚úÖ
‚îú‚îÄ‚îÄ src/trainer.py ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ src/dataset.py ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ src/utils/utils.py ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ src/utils/get_scheduler.py ‚úÖ
‚îî‚îÄ‚îÄ src/model/
    ‚îú‚îÄ‚îÄ sasrec.py ‚úÖ
    ‚îÇ   ‚îú‚îÄ‚îÄ embedding_layer.py ‚úÖ
    ‚îÇ   ‚îî‚îÄ‚îÄ self_attn_block.py ‚úÖ
    ‚îÇ       ‚îî‚îÄ‚îÄ pointwise_ffnn.py ‚úÖ
    ‚îú‚îÄ‚îÄ sasrec_lsq.py ‚úÖ
    ‚îú‚îÄ‚îÄ sasrec_pact.py ‚úÖ
    ‚îú‚îÄ‚îÄ sasrec_adaround.py ‚úÖ
    ‚îú‚îÄ‚îÄ sasrec_apot.py ‚úÖ
    ‚îú‚îÄ‚îÄ sasrec_dorefa.py ‚úÖ
    ‚îî‚îÄ‚îÄ sasrec_ste.py ‚úÖ
```

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:

```
‚ùå src/main.py (—Å—Ç–∞—Ä—ã–π)
‚ùå src/main_simple.py (—Å—Ç–∞—Ä—ã–π)
‚ùå src/utils/arguments.py (–∑–∞–º–µ–Ω—ë–Ω –Ω–∞ config.py)
‚ùå src/model/self_attn.py (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚ùå src/model/scaled_dotprod_attn.py (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ self_attn.py)
```

---

## üóëÔ∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

```bash
cd /Users/kochyanlv/Desktop/Study/ITMO/EfficientDL/EfficientDL_QAT/sasrec

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
rm src/main.py
rm src/main_simple.py

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã
rm src/utils/arguments.py

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏ –º–æ–¥–µ–ª–∏
rm src/model/self_attn.py
rm src/model/scaled_dotprod_attn.py
```

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `src/model/__init__.py`:

```python
# –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏:
from .scaled_dotprod_attn import scaled_dotprod_attn  # ‚ùå
from .self_attn import SelfAttn  # ‚ùå

# –ò –∏–∑ __all__:
"scaled_dotprod_attn",  # ‚ùå
"SelfAttn",  # ‚ùå
```

–ò –æ–±–Ω–æ–≤–∏—Ç—å `src/utils/__init__.py`:

```python
# –£–¥–∞–ª–∏—Ç—å:
from .arguments import get_args, DatasetArgs, ModelArgs, OptimizerArgs, TrainerArgs  # ‚ùå

# –ò –∏–∑ __all__:
"get_args",  # ‚ùå
"DatasetArgs",  # ‚ùå
"ModelArgs",  # ‚ùå
"OptimizerArgs",  # ‚ùå
"TrainerArgs",  # ‚ùå
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏)

```
sasrec/
‚îú‚îÄ‚îÄ config.py                    ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ training.py                  ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ README.md                    ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ movie-lens_1m.txt       ‚úÖ –î–∞—Ç–∞—Å–µ—Ç
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ dataset.py              ‚úÖ
    ‚îú‚îÄ‚îÄ trainer.py              ‚úÖ
    ‚îú‚îÄ‚îÄ model/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         ‚úÖ
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec.py           ‚úÖ –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_lsq.py       ‚úÖ LSQ
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_pact.py      ‚úÖ PACT
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_adaround.py  ‚úÖ AdaRound
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_apot.py      ‚úÖ APoT
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_dorefa.py    ‚úÖ DoReFa
    ‚îÇ   ‚îú‚îÄ‚îÄ sasrec_ste.py       ‚úÖ STE
    ‚îÇ   ‚îú‚îÄ‚îÄ embedding_layer.py  ‚úÖ
    ‚îÇ   ‚îú‚îÄ‚îÄ self_attn_block.py  ‚úÖ
    ‚îÇ   ‚îî‚îÄ‚îÄ pointwise_ffnn.py   ‚úÖ
    ‚îî‚îÄ‚îÄ utils/
        ‚îú‚îÄ‚îÄ __init__.py         ‚úÖ
        ‚îú‚îÄ‚îÄ utils.py            ‚úÖ
        ‚îî‚îÄ‚îÄ get_scheduler.py    ‚úÖ
```

**–ò—Ç–æ–≥–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: **19 —Ñ–∞–π–ª–æ–≤** ‚úÖ
- –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å: **5 —Ñ–∞–π–ª–æ–≤** ‚ùå
- –≠–∫–æ–Ω–æ–º–∏—è: ~26% —Ñ–∞–π–ª–æ–≤

---

## üîç –î–µ—Ç–∞–ª–∏ –ø–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º —Ñ–∞–π–ª–∞–º

### 1. `src/model/self_attn.py` ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ—Ç —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `__init__.py`, –Ω–æ **–Ω–∏–≥–¥–µ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**.

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
grep -r "import SelfAttn" sasrec/
grep -r "from.*SelfAttn[^B]" sasrec/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ –≤ __init__.py, –Ω–∏–≥–¥–µ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

**–í—ã–≤–æ–¥**: –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å.

### 2. `src/model/scaled_dotprod_attn.py` ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤ `self_attn.py`, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
grep -r "scaled_dotprod_attn" sasrec/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ –≤ self_attn.py –∏ __init__.py
```

**–í—ã–≤–æ–¥**: –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤–º–µ—Å—Ç–µ —Å `self_attn.py`.

### 3. `src/main.py` –∏ `src/main_simple.py` ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `training.py`.

**–û—Ç–ª–∏—á–∏—è**:
- `main.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç mlflow (—É–±—Ä–∞–ª–∏)
- `main_simple.py` - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ mlflow
- `training.py` - **–Ω–æ–≤—ã–π**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `config.py`, –æ–±—É—á–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏

**–í—ã–≤–æ–¥**: –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –æ–±–∞ —Å—Ç–∞—Ä—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞.

### 4. `src/utils/arguments.py` ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å `argparse`. –ó–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `config.py`.

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è**: –¢–æ–ª—å–∫–æ –≤ `main.py` –∏ `main_simple.py` (–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–∂–µ —É–¥–∞–ª—è–µ–º).

**–í—ã–≤–æ–¥**: –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å.

